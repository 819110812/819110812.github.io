import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e}from"./app.c21eb791.js";const t={},i=e(`<h1 id="golang-\u5E38\u89C1\u6570\u636E\u7ED3\u6784-slice-map-\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#golang-\u5E38\u89C1\u6570\u636E\u7ED3\u6784-slice-map-\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> Golang \u5E38\u89C1\u6570\u636E\u7ED3\u6784\uFF08Slice &amp; Map\uFF09\u5B9E\u73B0\u539F\u7406</h1><h2 id="slice" tabindex="-1"><a class="header-anchor" href="#slice" aria-hidden="true">#</a> Slice</h2><p>\u5207\u7247\u662Fgolang\u4E2D\u5F88\u5E38\u89C1\u7684\u6570\u636E\u7ED3\u6784\u4E4B\u4E00\uFF0C\u5B83\u4F9D\u8D56\u4E8E\u6570\u7EC4\u5B9E\u73B0\uFF0C\u5B83\u53EF\u4EE5\u5F88\u8F7B\u677E\u7684\u5B9E\u73B0\u6269\u5BB9\u3002</p><p>\u5728\u6E90\u7801\u5305<code>runtime/slice.go</code>\u4E2D\u5B9A\u4E49\u4E86\u57FA\u672C\u7684slice\u7ED3\u6784</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> slice <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	array unsafe<span class="token punctuation">.</span>Pointer
	<span class="token builtin">len</span>   <span class="token builtin">int</span>
	<span class="token builtin">cap</span>   <span class="token builtin">int</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>array</code>\u6307\u5411\u5E95\u5C42\u7684\u6570\u7EC4\uFF0C<code>len</code> \u8868\u793A\u5207\u7247\u7684\u957F\u5EA6\uFF0C<code>cap</code>\u8868\u793A\u5207\u7247\u7684\u5BB9\u91CF\u3002 \u7531\u4E8E\u6307\u5411\u4E86\u5E95\u5C42\u6570\u7EC4\uFF0C\u6240\u4EE5<code>slice</code>\u672C\u8D28\u4E0A\u548Cslice\u5171\u4EAB\u4E86\u5B58\u50A8\u7A7A\u95F4\u3002</p><p>\u4E3E\u4E2A\u6817\u5B50\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> array <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span>

    <span class="token keyword">var</span> slice <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;lenth of slice: &quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity of slice: &quot;</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>slice<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">&amp;</span>array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0\u4EE3\u7801\u5148\u662F\u5B9A\u4E49\u4E86\u4E00\u4E2A10\u4F4D\u7684\u6570\u7EC4\uFF0C\u7136\u540E\u5728\u8FD9\u4E2A\u57FA\u7840\u4E0A\u521B\u5EFA\u4E86\u4E00\u4E2A\u5207\u7247\uFF0C\u7136\u540E\u53BB\u6253\u5370\u51FA\u5207\u7247\u7684\u957F\u5EA6\uFF0C\u5BB9\u91CF\u4EE5\u53CA\u5207\u7247\u548C\u6570\u7EC4\u5730\u5740\u662F\u5426\u76F8\u7B49\u3002\u6700\u7EC8\u8F93\u51FA\u7684\u7ED3\u679C\u662F\uFF1A<code>1,5,true</code>\u3002\u6574\u4E2A\u5207\u7247\u53EF\u89C6\u5316\u51FA\u6765\u5E94\u8BE5\u662F\u8FD9\u6837\u7684\uFF1A</p><p><img src="https://golearning.oss-cn-shanghai.aliyuncs.com/obsidian20221001213722.png" alt="" loading="lazy"></p><h2 id="map" tabindex="-1"><a class="header-anchor" href="#map" aria-hidden="true">#</a> Map</h2><p>\u5728\u6E90\u7801<code>runtime/map.go</code>\u4E2D\u5B9A\u4E49\u4E86map\u7684\u57FA\u672C\u7ED3\u6784\uFF0Cmap\u5E95\u5C42\u662F\u7531\u54C8\u5E0C\u8868\u5B9E\u73B0\u7684\uFF0C\u4E00\u4E2A\u54C8\u5E0C\u8868\u53EF\u4EE5\u5173\u8054\u591A\u4E2A\u54C8\u5E0C\u8868\u8282\u70B9\uFF0C\u6BCF\u4E2A\u54C8\u5E0C\u8868\u4E2D\u90FD\u5B58\u4E86\u4E00\u4E2A\u952E\u503C\u5BF9\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// 1.19\u7248\u672C\u4E2D\u7684map\u7ED3\u6784</span>
<span class="token keyword">type</span> hmap <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// Note: the format of the hmap is also encoded in cmd/compile/internal/reflectdata/reflect.go.</span>
	<span class="token comment">// Make sure this stays in sync with the compiler&#39;s definition.</span>
	count     <span class="token builtin">int</span> <span class="token comment">// # live cells == size of map.  Must be first (used by len() builtin)</span>
	flags     <span class="token builtin">uint8</span>
	B         <span class="token builtin">uint8</span>  <span class="token comment">// log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span>
	noverflow <span class="token builtin">uint16</span> <span class="token comment">// approximate number of overflow buckets; see incrnoverflow for details</span>
	hash0     <span class="token builtin">uint32</span> <span class="token comment">// hash seed</span>

	buckets    unsafe<span class="token punctuation">.</span>Pointer <span class="token comment">// array of 2^B Buckets. may be nil if count==0.</span>
	oldbuckets unsafe<span class="token punctuation">.</span>Pointer <span class="token comment">// previous bucket array of half the size, non-nil only when growing</span>
	nevacuate  <span class="token builtin">uintptr</span>        <span class="token comment">// progress counter for evacuation (buckets less than this have been evacuated)</span>

	extra <span class="token operator">*</span>mapextra <span class="token comment">// optional fields</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u6E90\u7801\u4E2D\u6211\u4EEC\u53EF\u4EE5\u5F97\u5230\u8FD9\u4E48\u4E00\u4E9B\u4FE1\u606F\uFF0C</p><ul><li><code>hmap</code>\u6307\u5411\u4E86\u4E00\u4E9Bbuckets</li><li>\u6709\u4E00\u4E2Aextra\u7684\u5B57\u6BB5\u6765\u5B58\u50A8\u5176\u4F59\u4FE1\u606F</li></ul><p><img src="https://golearning.oss-cn-shanghai.aliyuncs.com/obsidian20221002083048.png" alt="" loading="lazy"></p><h3 id="mapextra\u57FA\u672C\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#mapextra\u57FA\u672C\u7ED3\u6784" aria-hidden="true">#</a> mapextra\u57FA\u672C\u7ED3\u6784</h3><p>\u5728hmap\u4E2D\u6709\u4E00\u4E2A\u5B57\u6BB5\u53EB<code>mapextra</code>\uFF0C\u5B83\u5176\u5B9E\u662F\u7528\u6765\u89E3\u51B3\u5F53\u54C8\u5E0C\u51B2\u7A81\u65F6\uFF0C\u6EA2\u51FA\u7684\u4E00\u4E9B\u54C8\u5E0C\u8868\u7684\u5B58\u50A8\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> mapextra <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// If both key and elem do not contain pointers and are inline, then we mark bucket</span>
	<span class="token comment">// type as containing no pointers. This avoids scanning such maps.</span>
	<span class="token comment">// However, bmap.overflow is a pointer. In order to keep overflow buckets</span>
	<span class="token comment">// alive, we store pointers to all overflow buckets in hmap.extra.overflow and hmap.extra.oldoverflow.</span>
	<span class="token comment">// overflow and oldoverflow are only used if key and elem do not contain pointers.</span>
	<span class="token comment">// overflow contains overflow buckets for hmap.buckets.</span>
	<span class="token comment">// oldoverflow contains overflow buckets for hmap.oldbuckets.</span>
	<span class="token comment">// The indirection allows to store a pointer to the slice in hiter.</span>
	overflow    <span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>bmap
	oldoverflow <span class="token operator">*</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>bmap

	<span class="token comment">// nextOverflow holds a pointer to a free overflow bucket.</span>
	nextOverflow <span class="token operator">*</span>bmap
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bucket\u7684\u57FA\u672C\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#bucket\u7684\u57FA\u672C\u7ED3\u6784" aria-hidden="true">#</a> bucket\u7684\u57FA\u672C\u7ED3\u6784</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> bmap <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// tophash generally contains the top byte of the hash value</span>
	<span class="token comment">// for each key in this bucket. If tophash[0] &lt; minTopHash,</span>
	<span class="token comment">// tophash[0] is a bucket evacuation state instead.</span>
	tophash <span class="token punctuation">[</span>bucketCnt<span class="token punctuation">]</span><span class="token builtin">uint8</span>
	<span class="token comment">// Followed by bucketCnt keys and then bucketCnt elems.</span>
	<span class="token comment">// NOTE: packing all the keys together and then all the elems together makes the</span>
	<span class="token comment">// code a bit more complicated than alternating key/elem/key/elem/... but it allows</span>
	<span class="token comment">// us to eliminate padding which would be needed for, e.g., map[int64]int8.</span>
	<span class="token comment">// Followed by an overflow pointer.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\u7684\u662F<code>bmap</code>\u4E2D\u5B58\u50A8\u4E86\u56FA\u5B9A\u957F\u5EA6\u7684\u54C8\u5E0C\u503C\uFF0C\u8FD9\u4E2A\u957F\u5EA6\u7684\u5927\u5C0F\u662F<code>buckerCnt</code>\uFF0C\u4EE3\u7801\u4E2D\u9ED8\u8BA4\u662F8\u4F4D\u3002</p><h3 id="\u54C8\u5E0C\u51B2\u7A81" tabindex="-1"><a class="header-anchor" href="#\u54C8\u5E0C\u51B2\u7A81" aria-hidden="true">#</a> \u54C8\u5E0C\u51B2\u7A81</h3><p>\u5F53\u6709\u4E24\u4E2A\u6216\u4EE5\u4E0A\u6570\u91CF\u7684\u952E\u88AB\u54C8\u5E0C\u5230\u4E86\u540C\u4E00\u4E2Abucket\u65F6\uFF0C\u6211\u4EEC\u79F0\u8FD9\u4E9B\u952E\u53D1\u751F\u4E86\u51B2\u7A81\u3002Go\u4F7F\u7528\u94FE\u5730\u5740\u6CD5\u6765\u89E3\u51B3\u952E\u51B2\u7A81\u3002 \u7531\u4E8E\u6BCF\u4E2Abucket\u53EF\u4EE5\u5B58\u653E8\u4E2A\u952E\u503C\u5BF9\uFF0C\u6240\u4EE5\u540C\u4E00\u4E2Abucket\u5B58\u653E\u8D85\u8FC78\u4E2A\u952E\u503C\u5BF9\u65F6\u5C31\u4F1A\u518D\u521B\u5EFA\u4E00\u4E2A\u952E\u503C\u5BF9\uFF0C\u7528\u7C7B\u4F3C\u94FE\u8868\u7684\u65B9\u5F0F\u5C06bucket\u8FDE\u63A5\u8D77\u6765 (\u6E90\u7801\u4E2D\u7684<code>extra</code>)\u3002</p><h3 id="\u8D1F\u8F7D\u56E0\u5B50-rehash" tabindex="-1"><a class="header-anchor" href="#\u8D1F\u8F7D\u56E0\u5B50-rehash" aria-hidden="true">#</a> \u8D1F\u8F7D\u56E0\u5B50 &amp; Rehash</h3><p>\u5728<code>map.go</code>\u4E2D\u6709\u4E00\u4E2A\u53EB\u505A<code>overLoadFactor</code>\u7684\u65B9\u6CD5\u6765\u5224\u65AD\u5F53\u524D\u7684<code>map</code>\u662F\u5426\u8FC7\u5927\uFF0C\u54C8\u5E0C\u8868\u9700\u8981\u5C06\u8D1F\u8F7D\u56E0\u5B50\u63A7\u5236\u5728\u5408\u9002\u7684\u5927\u5C0F\uFF0C\u8D85\u8FC7\u5176\u9600\u503C\u9700\u8981\u8FDB\u884Crehash\uFF0C\u4E5F\u5373\u952E\u503C\u5BF9\u91CD\u65B0\u7EC4\u7EC7\uFF1A</p><ul><li>\u54C8\u5E0C\u56E0\u5B50\u8FC7\u5C0F\uFF0C\u8BF4\u660E\u7A7A\u95F4\u5229\u7528\u7387\u4F4E</li><li>\u54C8\u5E0C\u56E0\u5B50\u8FC7\u5927\uFF0C\u8BF4\u660E\u51B2\u7A81\u4E25\u91CD\uFF0C\u5B58\u53D6\u6548\u7387\u4F4E</li></ul><h3 id="\u67E5\u627E\u548C\u63D2\u5165" tabindex="-1"><a class="header-anchor" href="#\u67E5\u627E\u548C\u63D2\u5165" aria-hidden="true">#</a> \u67E5\u627E\u548C\u63D2\u5165</h3><p>\u67E5\u627E\u8FC7\u7A0B\u5982\u4E0B\uFF1A</p><ol><li>\u6839\u636Ekey\u503C\u7B97\u51FA\u54C8\u5E0C\u503C</li><li>\u53D6\u54C8\u5E0C\u503C\u4F4E\u4F4D\u4E0Ehmap.B\u53D6\u6A21\u786E\u5B9Abucket\u4F4D\u7F6E</li><li>\u53D6\u54C8\u5E0C\u503C\u9AD8\u4F4D\u5728tophash\u6570\u7EC4\u4E2D\u67E5\u8BE2</li><li>\u5982\u679Ctophash[i]\u4E2D\u5B58\u50A8\u503C\u4E5F\u54C8\u5E0C\u503C\u76F8\u7B49\uFF0C\u5219\u53BB\u627E\u5230\u8BE5bucket\u4E2D\u7684key\u503C\u8FDB\u884C\u6BD4\u8F83</li><li>\u5F53\u524Dbucket\u6CA1\u6709\u627E\u5230\uFF0C\u5219\u7EE7\u7EED\u4ECE\u4E0B\u4E2Aoverflow\u7684bucket\u4E2D\u67E5\u627E\u3002</li><li>\u5982\u679C\u5F53\u524D\u5904\u4E8E\u642C\u8FC1\u8FC7\u7A0B\uFF0C\u5219\u4F18\u5148\u4ECEoldbuckets\u67E5\u627E</li></ol><p>\u65B0\u5143\u7D20\u63D2\u5165\u8FC7\u7A0B\u5982\u4E0B\uFF1A</p><ol><li>\u6839\u636Ekey\u503C\u7B97\u51FA\u54C8\u5E0C\u503C</li><li>\u53D6\u54C8\u5E0C\u503C\u4F4E\u4F4D\u4E0Ehmap.B\u53D6\u6A21\u786E\u5B9Abucket\u4F4D\u7F6E</li><li>\u67E5\u627E\u8BE5key\u662F\u5426\u5DF2\u7ECF\u5B58\u5728\uFF0C\u5982\u679C\u5B58\u5728\u5219\u76F4\u63A5\u66F4\u65B0\u503C</li><li>\u5982\u679C\u6CA1\u627E\u5230\u5C06key\uFF0C\u5C06key\u63D2\u5165</li></ol><p><img src="https://golearning.oss-cn-shanghai.aliyuncs.com/obsidian\u626B\u7801_\u641C\u7D22\u8054\u5408\u4F20\u64AD\u6837\u5F0F-\u6807\u51C6\u8272\u7248.png" alt="" loading="lazy"></p>`,33),o=[i];function l(c,p){return s(),a("div",null,o)}var u=n(t,[["render",l],["__file","Goalng \u5E38\u89C1\u6570\u636E\u7ED3\u6784\u5B9E\u73B0\u539F\u7406.html.vue"]]);export{u as default};
